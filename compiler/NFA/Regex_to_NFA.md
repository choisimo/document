# 정규 표현식 → NFA: Thomson’s Construction

## 1. 개요
- Thomson’s Construction: 정규 표현식을 NFA로 기계적으로 변환
- ε-전이로 작은 NFA 부품을 조합하여 복잡한 표현식 처리

---

## 2. 구성 요소 (Building Blocks)

### 2.1. 문자 (c)
- **설명:** 단일 문자 NFA

```mermaid
graph LR
  S0(( )) -- c --> S1(( ))
```  

### 2.2. 합집합 (Union, R|S)
- **설명:** R 또는 S 중 하나 선택

```mermaid
graph LR
  U0(( )) -- ε --> R0(( ))
  U0 -- ε --> S0(( ))
  R0 -- a --> R1(( ))
  S0 -- b --> S1(( ))
  R1 -- ε --> U1(( ))
  S1 -- ε --> U1(( ))
```  

### 2.3. 연결 (Concatenation, RS)
- **설명:** R 다음에 S 순차 실행

```mermaid
graph LR
  R0(( )) -- a --> R1(( ))
  R1 -- ε --> S0(( ))
  S0 -- b --> S1(( ))
```  

### 2.4. 클레이니 스타 (Kleene Star, R*)
- **설명:** 0번 이상 반복

```mermaid
graph LR
  K0(( )) -- ε --> R0(( ))
  R0 -- a --> R1(( ))
  R1 -- ε --> R0
  R1 -- ε --> K1(( ))
  K0 -- ε --> K1(( ))
```  

---

## 3. 예제: `(a|b)*abb`
### 3.1. `a|b` (Union)
```mermaid
graph LR
  U0((S0)) -- ε --> U1((S1))
  U0 -- ε --> U2((S2))
  U1 -- a --> U3((S3))
  U2 -- b --> U4((S4))
  U3 -- ε --> U5((S5))
  U4 -- ε --> U5((S5))
  style U0 fill:#9f9
  style U5 fill:#f96
```  
| 상태 | a 이동 | b 이동 | ε 이동     |
|:----:|:-------|:-------|:-----------|
| S0   |        |        | {S1, S2}   |
| S1   | a→S3   |        |            |
| S2   |        | b→S4   |            |
| S3   |        |        | {S5}       |
| S4   |        |        | {S5}       |
| S5   |        |        |            |

---
### 3.2. `(a|b)*` (Kleene Star)
```mermaid
graph LR
  K0((S0)) -- ε --> U0((S1))
  K0 -- ε --> K1((S5))
  U0 -- ε --> U1((S2))
  U0 -- ε --> U2((S4))
  U1 -- a --> U3((S3))
  U2 -- b --> U4((S5))
  U3 -- ε --> U6((S6))
  U4 -- ε --> U6((S6))
  U6 -- ε --> U0
  U6 -- ε --> K1
  style K0 fill:#9f9
  style K1 fill:#f96
```  
| 상태 | a 이동 | b 이동 | ε 이동           |
|:----:|:-------|:-------|:-----------------|
| S0   |        |        | {S1, S5}         |
| S1   |        |        | {S2, S4}         |
| S2   | a→S3   |        |                  |
| S3   |        |        | {S6}             |
| S4   |        | b→S5   |                  |
| S5   |        |        | {S6}             |
| S6   |        |        | {S1, S5}         |

---
### 3.3. `abb` (Concatenation)
```mermaid
graph LR
  C0((S5)) -- a --> C1((S6))
  C1 -- b --> C2((S7))
  C2 -- b --> C3((S8))
  style C3 fill:#f96
```  
| 상태 | a 이동 | b 이동 | ε 이동 |
|:----:|:-------|:-------|:-------|
| S5   | a→S6   |        |        |
| S6   |        | b→S7   |        |
| S7   |        | b→S8   |        |
| S8   |        |        |        |

---
### 3.4. 최종 NFA
```mermaid
graph LR
  S0((S0)) -- ε --> S1((S1))
  S0 -- ε --> S5((S5))
  S1 -- ε --> S2((S2))
  S1 -- ε --> S4((S4))
  S2 -- a --> S3((S3))
  S4 -- b --> S5((S5))
  S3 -- ε --> S6((S6))
  S5 -- ε --> S6((S6))
  S6 -- ε --> S1((S1))
  S6 -- ε --> S5((S5))
  S5 -- a --> S7((S7))
  S7 -- b --> S8((S8))
  S8 -- b --> S9((Accept))
  style S0 fill:#9f9
  style S9 fill:#f96
```  
| 상태 | a 이동 | b 이동 | ε 이동         |
|:----:|:-------|:-------|:---------------|
| S0   |        |        | {S1, S5}       |
| S1   |        |        | {S2, S4}       |
| S2   | a→S3   |        |                |
| S3   |        |        | {S6}           |
| S4   |        | b→S5   |                |
| S5   |        |        | {S6}           |
| S6   |        |        | {S1, S5}       |
| S7   | a→S7   |        |                |
| S7   |        | b→S8   |                |
| S8   |        | b→S9   |                |
| S9   |        |        |                |

---

> **결론:** Thomson’s Construction을 통해 `(a|b)*abb`를 단계별로 분해·조합하여 정확한 NFA를 만들었습니다.