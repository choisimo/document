## Proxmox VE(PVE) OS를 새 SSD로 마이그레이션하는 방법**중요한 사전 준비:**

  * **데이터 백업:** 마이그레이션 과정 중 예기치 않은 문제가 발생할 수 있으니, **모든 VM과 CT의 백업을 반드시 받아두시기 바랍니다.**
  * **새 SSD 준비:** 새로운 SSD를 Proxmox 서버에 물리적으로 연결합니다.
  * **Proxmox VE ISO 파일:** 만약을 대비하여 Proxmox VE 설치용 USB를 준비해두면 좋습니다.

-----

### 방법 1: 디스크 전체 복제 (Clonezilla 또는 dd 사용)

기존 드라이브의 모든 데이터를 새 드라이브로 비트 단위로 복사하는 가장 확실한 방법입니다. 기존 드라이브와 새 드라이브의 용량이 같거나, 새 드라이브가 더 큰 경우에 적합합니다.

**장점:**

  * 가장 간단하고 직관적인 방법입니다.
  * OS 설정, VM/CT 구성 등 모든 환경이 그대로 이전됩니다.

**단점:**

  * 복제하는 동안 Proxmox 서버를 중지해야 합니다.
  * 새 SSD의 용량이 기존 SSD보다 작으면 사용할 수 없습니다.

#### **Clonezilla 사용 단계 (권장):**

Clonezilla는 디스크 복제를 위한 강력하고 사용하기 쉬운 무료 도구입니다.

1.  **Clonezilla Live USB 준비:** Clonezilla 웹사이트에서 ISO 파일을 다운로드하여 부팅 가능한 USB 드라이브를 만듭니다.
2.  **Clonezilla 부팅:** 서버를 종료하고 Clonezilla USB로 부팅합니다.
3.  **`device-device` 모드 선택:** 디스크(device)에서 디스크(device)로 직접 복제하는 모드를 선택합니다.
4.  **원본 및 대상 디스크 선택:**
      * **원본(Source):** 현재 Proxmox가 설치된 기존 드라이브를 선택합니다.
      * **대상(Target):** 새로 설치한 SSD를 선택합니다. **(주의: 대상 디스크의 모든 데이터는 삭제됩니다\!)**
5.  **복제 시작:** 옵션을 확인하고 복제를 시작합니다. 디스크 용량과 속도에 따라 시간이 소요됩니다.
6.  **마무리:** 복제가 완료되면 시스템을 종료하고 기존 드라이브를 제거합니다. 그 후 새 SSD로 부팅하여 정상적으로 동작하는지 확인합니다.

#### **`dd` 명령어 사용 단계 (고급 사용자용):**

`dd` 명령어는 강력하지만, 디스크를 잘못 선택하면 데이터가 영구적으로 삭제될 수 있으므로 극도의 주의가 필요합니다.

1.  Proxmox VE가 아닌 다른 리눅스 라이브 USB (예: Ubuntu)로 부팅합니다.

2.  `lsblk` 또는 `fdisk -l` 명령어로 원본 디스크(`if`)와 대상 디스크(`of`)의 정확한 장치명(예: `/dev/sda`, `/dev/sdb`)을 확인합니다.

3.  아래 명령어를 실행하여 복제를 시작합니다.

    ```bash
    dd if=/dev/sdX of=/dev/sdY bs=64K conv=noerror,sync status=progress
    ```

      * `/dev/sdX`: 원본 디스크 (예: `/dev/sda`)
      * `/dev/sdY`: 대상 디스크 (새 SSD, 예: `/dev/sdb`)
      * `bs=64K`: 블록 크기 설정 (성능 향상에 도움)
      * `conv=noerror,sync`: 읽기 오류가 발생해도 계속 진행
      * `status=progress`: 진행 상태를 표시

4.  복제가 완료되면 시스템을 종료하고 원본 드라이브를 제거한 후 새 SSD로 부팅합니다.

-----

### 방법 2: 설정 백업 후 새로 설치 및 복원

새로운 SSD에 Proxmox VE를 새로 설치하고, 기존 시스템의 핵심 설정 파일만 백업하여 복원하는 방식입니다. "깨끗한" 설치를 선호할 때 좋은 방법입니다.

**장점:**

  * 시스템을 깨끗한 상태로 재구성할 수 있습니다.
  * 디스크 파티션 구조 등을 새로 구성할 수 있습니다.

**단점:**

  * 과정이 더 복잡하고 시간이 오래 걸립니다.
  * 일부 수동 설정이 추가로 필요할 수 있습니다.

#### **진행 단계:**

1.  **핵심 설정 파일 백업:**

      * Proxmox 서버에 SSH로 접속하거나 콘솔을 엽니다.
      * 가장 중요한 `/etc/pve` 디렉토리를 압축하여 백업합니다. 이 디렉토리에는 VM/CT 설정, 클러스터 정보 등이 모두 들어있습니다.
        ```bash
        tar czf pve-etc-backup.tar.gz /etc/pve
        ```
      * 네트워크 설정(`/etc/network/interfaces`), 스토리지 설정(`/etc/pve/storage.cfg`) 등 다른 중요한 설정 파일들도 별도로 백업해두면 좋습니다.
      * 백업한 `pve-etc-backup.tar.gz` 파일을 USB나 네트워크 드라이브 등 외부 저장소로 복사해 둡니다.

2.  **새 SSD에 Proxmox VE 새로 설치:**

      * 기존 드라이브를 제거하고 새 SSD를 장착합니다.
      * Proxmox VE 설치 USB로 부팅하여 새 SSD에 OS를 설치합니다.

3.  **설정 파일 복원:**

      * 설치가 완료되면 새로 설치된 Proxmox에 접속합니다.
      * 외부에 보관했던 `pve-etc-backup.tar.gz` 파일을 서버로 복사합니다.
      * **복원 전, 만약을 위해 새로 설치된 `/etc/pve` 디렉토리도 백업해 둡니다.**
        ```bash
        mv /etc/pve /etc/pve-new
        ```
      * 백업 파일을 `/etc` 디렉토리에 압축 해제합니다.
        ```bash
        tar xzf pve-etc-backup.tar.gz -C /etc
        ```

4.  **재부팅 및 확인:**

      * 시스템을 재부팅합니다.
      * 재부팅 후 웹 UI에 접속하여 기존 VM/CT 목록과 설정이 정상적으로 보이는지 확인합니다. VM/CT 데이터가 저장된 디스크가 정상적으로 연결되어 있다면 그대로 인식됩니다.

### 결론

특별한 이유가 없다면 **Clonezilla를 이용한 방법 1**이 가장 안전하고 확실하게 OS를 마이그레이션하는 방법으로 추천됩니다. 시스템을 처음부터 다시 구성하고 싶을 때에만 방법 2를 고려하는 것이 좋습니다.

## Proxmox VE(PVE) OS를 새 SSD로 마이그레이션하는 방법

Proxmox VE(PVE)의 OS가 설치된 기존 드라이브를 더 빠르거나 용량이 큰 새 SSD로 마이그레이션하는 방법은 크게 두 가지가 있습니다. 각 방법의 장단점을 확인하고 자신의 상황에 맞는 방법을 선택하는 것이 중요합니다.

**🚨 중요: 작업을 시작하기 전**

  * **VM 및 CT 백업:** 가장 중요합니다. PVE에 있는 모든 가상머신(VM)과 컨테이너(CT)를 외부 저장소에 반드시 백업하십시오.
  * **/etc/pve 디렉토리 백업:** PVE의 모든 설정(VM 구성, 스토리지, 클러스터 정보 등)이 담겨있습니다. 이 디렉토리를 별도로 백업해두면 문제가 생겼을 때 복구하기 용이합니다.
    ```bash
    # PVE 노드의 셸에서 실행
    tar -czf pve-etc-backup-$(date +%Y-%m-%d).tar.gz /etc/pve
    ```
    생성된 `pve-etc-backup-....tar.gz` 파일을 USB나 네트워크 드라이브 등 안전한 곳에 복사해 두십시오.

-----

### 방법 1: 디스크 전체 복제 (Disk Cloning)

기존 드라이브의 모든 데이터를 새 SSD에 그대로 복제하는 방법입니다. **기존 드라이브와 새 SSD의 물리적 섹터 크기가 동일할 때 가장 안정적**이며, 일반적으로 가장 많이 사용되는 방법입니다.

**장점:**

  * OS와 모든 설정을 그대로 옮기므로, 성공 시 추가 설정이 거의 필요 없습니다.
  * 작업 시간이 비교적 짧습니다.

**단점:**

  * 복제 과정에서 실수하면 원본 데이터가 손상될 위험이 있습니다.
  * 복제 후 새 SSD의 남는 공간을 사용하려면 파티션 및 LVM/ZFS 크기 조정 작업이 필요합니다.
  * 원본 디스크보다 작은 디스크로는 복제가 불가능합니다.

#### **작업 절차 (Clonezilla 사용 권장)**

가장 안전하고 널리 사용되는 `Clonezilla` Live USB를 이용하는 방법입니다.

1.  **준비물:**

      * Clonezilla Live USB ([다운로드 페이지](https://clonezilla.org/downloads.php)에서 stable 버전 다운로드 후 Rufus 등으로 제작)
      * PC에 새 SSD를 연결할 수 있는 여분의 SATA 포트 또는 USB-SATA 어댑터

2.  **디스크 복제:**

      * Proxmox 서버를 종료합니다.
      * 새 SSD를 서버에 연결합니다.
      * Clonezilla Live USB로 부팅합니다.
      * `Device-device` (디스크-디스크) 복제 모드를 선택합니다.
      * **원본(Source) 디스크**로 기존 Proxmox OS 드라이브를 선택합니다.
      * **대상(Target) 디스크**로 새로 장착한 SSD를 선택합니다.
      * **경고 메시지를 여러 번 확인**하고 복제를 진행합니다. 대상 디스크의 모든 데이터는 삭제됩니다.

3.  **디스크 교체 및 부팅:**

      * 복제가 완료되면 서버를 종료합니다.
      * **기존 Proxmox OS 드라이브를 제거**하고, 그 자리에 복제된 새 SSD를 장착합니다.
      * 서버를 부팅하여 Proxmox가 정상적으로 시작되는지 확인합니다.

4.  **파티션 및 스토리지 크기 조정 (새 SSD가 더 큰 경우):**

      * PVE가 정상 부팅되면, 이제 새 SSD의 추가된 공간을 사용하도록 시스템에 알려줘야 합니다. Proxmox는 기본적으로 LVM-thin 또는 ZFS로 설치됩니다.

      * **(LVM-thin 방식일 경우)**

          * `gparted`와 같은 파티션 도구를 사용하여 LVM이 포함된 파티션의 크기를 먼저 늘립니다.
          * 그 다음, PVE 노드의 셸에서 다음 명령어를 순서대로 실행하여 LVM Physical Volume(PV), Volume Group(VG), Logical Volume(LV)의 크기를 확장합니다.
            ```bash
            # 1. Physical Volume 리사이즈
            pvresize /dev/sdX3  # sdX3는 LVM 파티션명, lsblk로 확인

            # 2. Free PE/Size 확인
            vgdisplay pve

            # 3. root 볼륨 확장 (사용 가능한 모든 공간 할당)
            lvresize -l +100%FREE /dev/pve/root
            resize2fs /dev/mapper/pve-root

            # 4. data 볼륨 확장 (필요 시)
            # lvresize -l +100%FREE /dev/pve/data
            ```

      * **(ZFS 방식일 경우)**

          * ZFS는 훨씬 간단합니다. `gdisk`나 `parted`로 GPT 파티션을 수정하여 디스크 전체를 사용하도록 설정한 후, ZFS가 파티션 변경을 인식하도록 다음 명령어를 실행하면 됩니다.
            ```bash
            # 1. ZFS 풀이 있는 디스크의 파티션 번호 확인 (보통 3번)
            # lsblk

            # 2. 해당 파티션에 대해 autoexpand 속성 활성화
            zpool online -e rpool /dev/sdX3 # sdX3는 ZFS 파티션명
            ```

-----

### 방법 2: Proxmox 재설치 및 설정 복원

새 SSD에 Proxmox를 새로 설치한 뒤, 미리 백업해 둔 설정 파일을 복원하는 방법입니다. **가장 안전하고 깔끔한 방법**으로 권장됩니다.

**장점:**

  * 디스크 복제 시 발생할 수 있는 잠재적 오류(부트로더, 파티션 테이블 등)에서 자유롭습니다.
  * 시스템을 깨끗한 상태에서 새로 시작할 수 있습니다.
  * 디스크 크기가 다르거나 섹터 크기가 달라도 문제없이 마이그레이션 가능합니다.

**단점:**

  * Proxmox를 재설치해야 하므로 시간이 더 걸릴 수 있습니다.
  * 설정 복원 과정에서 누락되는 부분이 있을 수 있으나, `/etc/pve`만 잘 복원하면 대부분 문제없습니다.

#### **작업 절차**

1.  **사전 준비 (가장 중요):**

      * **모든 VM/CT 백업** 및 외부 저장소로 이동
      * **/etc/pve 디렉토리 백업** (`tar` 이용, 위 설명 참조) 및 외부 저장소로 이동

2.  **Proxmox 재설치:**

      * 기존 OS 드라이브를 제거하고 새 SSD를 장착합니다.
      * 최신 Proxmox VE ISO 이미지로 부팅하여 새 SSD에 설치를 진행합니다.
      * **주의:** 설치 과정에서 **기존과 동일한 호스트 이름(Hostname)과 IP 주소**를 설정하는 것이 좋습니다.

3.  **설정 복원:**

      * 설치가 완료되고 PVE가 부팅되면, 노드의 셸(콘솔)에 접근합니다.
      * 외부 저장소에 백업해 둔 `pve-etc-backup-....tar.gz` 파일을 PVE 노드의 `/tmp` 디렉토리 등으로 복사합니다.
      * 다음 명령어를 실행하여 Proxmox 관련 서비스를 중지하고 설정을 복원합니다.
        ```bash
        # PVE 클러스터 파일 시스템과 프록시 서비스 중지
        systemctl stop pve-cluster
        systemctl stop pveproxy

        # 기존 설정 디렉토리 삭제 (이미 비어있거나 기본값만 있음)
        rm -rf /etc/pve

        # 백업한 설정 파일 압축 해제
        tar -xzf /tmp/pve-etc-backup-....tar.gz -C /

        # 재부팅
        reboot
        ```

4.  **확인 및 백업 복원:**

      * 재부팅 후 웹 인터페이스에 접속하여 기존과 동일하게 스토리지 설정, VM 구성 등이 보이는지 확인합니다.
      * VM/CT 백업 파일을 PVE 스토리지로 다시 업로드하고 복원(Restore) 작업을 진행합니다.

### 결론: 어떤 방법을 선택해야 할까?

  * **초보자 또는 안정성을 최우선으로 하는 경우:** \*\*방법 2 (재설치 및 복원)\*\*를 강력히 추천합니다. 가장 안전하며 예상치 못한 문제를 피할 수 있습니다.
  * **시스템 중단 시간을 최소화하고 싶은 숙련된 사용자:** \*\*방법 1 (디스크 복제)\*\*을 사용할 수 있습니다. 단, 파티션 및 파일 시스템 조정에 대한 이해가 필요합니다.

어떤 방법을 선택하든 **가장 중요한 것은 VM/CT와 `/etc/pve` 설정의 사전 백업**이라는 점을 잊지 마십시오.

## Proxmox VE(PVE) OS를 새 SSD 드라이브로 마이그레이션하는 방법

Proxmox VE(PVE)의 OS가 설치된 기존 디스크(HDD 또는 소용량 SSD)를 더 빠르거나 용량이 큰 새 SSD로 마이그레이션하는 것은 서버 안정성과 성능 향상을 위해 효과적인 업그레이드입니다.

마이그레이션 방법은 크게 두 가지로 나뉩니다.

1.  **디스크 전체 복제 (Cloning):** 기존 디스크의 모든 내용을 새 SSD에 그대로 복사하는 방식입니다. 가장 일반적이고 권장되는 방법입니다.
2.  **신규 설치 후 설정 복원:** 새 SSD에 Proxmox VE를 새로 설치한 뒤, 기존의 중요 설정 파일들을 덮어쓰는 방식입니다.

**가장 중요한 사전 작업: 백업\!**
어떤 방법을 사용하든, 작업 시작 전에 모든 VM과 CT(컨테이너)의 백업을 반드시 생성하여 외장 스토리지나 NAS 등 안전한 곳에 보관해야 합니다. 또한 `/etc/pve` 디렉토리의 사본을 별도로 만들어 두는 것이 좋습니다.

-----

### 방법 1: 디스크 전체 복제 (권장)

이 방법은 기존 시스템을 그대로 새 드라이브로 옮겨오므로 가장 안전하고 편리합니다. `Clonezilla`와 같은 디스크 복제 전문 도구를 사용하는 것이 가장 안정적이며, 리눅스 `dd` 명령어를 사용할 수도 있습니다.

#### 1단계: Clonezilla Live USB 준비 및 부팅

1.  [Clonezilla Live 다운로드 페이지](https://clonezilla.org/downloads.php)에서 **stable** 버전의 **amd64 (x86-64)**, **ISO** 파일을 다운로드합니다.
2.  [Rufus](https://rufus.ie/ko/) 또는 [Ventoy](https://www.ventoy.net/en/index.html)와 같은 도구를 사용하여 다운로드한 ISO 파일로 부팅 가능한 USB 드라이브를 만듭니다.
3.  Proxmox 서버의 전원을 끄고, 기존 OS 드라이브와 **새 SSD를 모두 서버에 연결**합니다.
4.  서버를 켠 후 BIOS/UEFI 설정에 진입하여 부팅 순서를 방금 만든 Clonezilla Live USB가 첫 번째가 되도록 변경하고 부팅합니다.

#### 2단계: Clonezilla를 이용한 디스크 복제

1.  Clonezilla 부팅 메뉴가 나타나면 기본 옵션(`Clonezilla live (Default settings, VGA 800x600)`)을 선택하여 부팅합니다.
2.  언어(English), 키보드 레이아웃(`Don't touch keymap`)을 차례로 선택합니다.
3.  `Start Clonezilla`를 선택합니다.
4.  **`device-device`** (디스크-투-디스크 복제) 옵션을 선택합니다.
5.  `Beginner` 모드를 선택하면 대부분의 설정을 자동으로 처리해 주어 편리합니다.
6.  **`disk_to_local_disk`** (로컬 디스크 복제)를 선택합니다.
7.  **원본 디스크 선택:** 현재 Proxmox가 설치된 드라이브를 선택합니다. 모델명과 용량을 잘 확인하여 실수하지 않도록 주의합니다.
8.  **대상 디스크 선택:** 새로 설치할 SSD를 선택합니다. **대상 디스크의 모든 데이터는 삭제되므로 다시 한번 확인합니다.**
9.  `-sfsck`(원본 파일 시스템 검사 건너뛰기) 옵션은 그대로 두거나 필요에 따라 선택합니다.
10. 복제가 완료된 후 어떤 작업을 할지 묻는 메시지가 나오면 `Poweroff` 또는 `Reboot`를 선택합니다.
11. 복제가 시작되기 전 마지막으로 경고 메시지를 보여줍니다. `y`를 입력하고 Enter를 눌러 복제를 시작합니다.
12. 복제가 완료되면 시스템을 종료하고 **기존 OS 드라이브를 서버에서 제거**합니다.

#### 3단계: 파티션 및 스토리지 크기 확장 (매우 중요)

새 SSD가 기존 디스크보다 용량이 큰 경우, 복제 후 남는 공간을 사용하도록 파티션과 LVM 또는 ZFS의 크기를 조절해야 합니다.

1.  새 SSD로 부팅이 정상적으로 되는지 확인합니다.
2.  Proxmox 셸에 접근하여 다음을 진행합니다.

**Proxmox가 LVM으로 설치된 경우 (기본값):**

1.  `gparted`를 사용하여 파티션 크기를 늘립니다.

    ```bash
    apt update && apt install gparted -y
    gparted
    ```

      * GParted 인터페이스에서 LVM 파티션(예: `/dev/sda3`)을 선택하고 `Resize/Move`를 클릭하여 할당되지 않은 공간까지 파티션을 확장합니다.

2.  물리 볼륨(PV), 논리 볼륨(LV) 크기를 확장합니다.

    ```bash
    # 물리 볼륨 리사이즈
    pvresize /dev/sdX3  # gparted에서 확장한 파티션 경로

    # 'pve/data' 논리 볼륨을 남는 공간 전체로 확장
    lvextend -l +100%FREE /dev/pve/data

    # 파일 시스템 리사이즈
    resize2fs /dev/mapper/pve-data
    ```

**Proxmox가 ZFS로 설치된 경우:**

ZFS는 파티션 크기를 조절하는 과정이 더 간단합니다.

1.  `gdisk`를 사용해 GPT 파티션 정보를 수정하여 디스크 전체를 사용하도록 합니다.

    ```bash
    gdisk /dev/sdX  # 새 SSD의 장치명 (예: sda)
    ```

      * `x` (전문가 모드) -\> `e` (GPT 재배치) -\> `w` (쓰기) -\> `Y` (확인) 순서로 진행합니다.

2.  ZFS 풀(rpool)이 자동으로 공간을 인식하도록 설정하고 확장합니다.

    ```bash
    zpool set autoexpand=on rpool
    zpool online -e rpool /dev/sdXN # ZFS 파티션 (예: sda3)
    ```

-----

### 방법 2: 신규 설치 후 설정 복원

이 방법은 디스크 복제에 실패했거나, 시스템을 깨끗하게 재구성하고 싶을 때 유용합니다. 단, 클러스터 환경에서는 권장되지 않습니다.

1.  **기존 시스템 설정 백업:**

      * Proxmox 셸에 접속하여 가장 중요한 `/etc/pve` 디렉토리를 압축하여 백업합니다. 이 디렉토리에는 VM/CT 설정, 스토리지 설정 등이 모두 포함되어 있습니다.

    <!-- end list -->

    ```bash
    tar czf pve-etc-backup.tar.gz /etc/pve
    ```

      * WinSCP나 `scp` 명령어를 사용하여 이 백업 파일을 PC나 다른 서버로 복사해 둡니다.
      * 네트워크 설정(`/etc/network/interfaces`), 호스트 정보(`/etc/hosts`, `/etc/hostname`) 등도 참고용으로 백업해두면 좋습니다.

2.  **Proxmox VE 신규 설치:**

      * 기존 드라이브를 제거하고 새 SSD를 장착합니다.
      * Proxmox VE 설치 ISO로 부팅하여 새 SSD에 OS를 설치합니다.

3.  **설정 복원:**

      * 설치가 완료되면, 백업해 두었던 `pve-etc-backup.tar.gz` 파일을 새 서버의 `/tmp` 디렉토리 등으로 복사합니다.
      * 기존 `/etc/pve`를 삭제하고 백업 파일의 압축을 해제하여 복원합니다.

    <!-- end list -->

    ```bash
    # pve-cluster 서비스 중지
    systemctl stop pve-cluster

    # 기존 설정 디렉토리 이동
    mv /etc/pve /etc/pve_new

    # 백업한 설정 복원
    tar xzf /tmp/pve-etc-backup.tar.gz -C /

    # 시스템 재부팅
    reboot
    ```

4.  **확인:** 재부팅 후 VM과 컨테이너 목록, 스토리지 설정이 이전과 동일하게 나타나는지 확인합니다.

### 방법 비교

| 항목 | 디스크 전체 복제 (Clonezilla) | 신규 설치 후 설정 복원 |
| :--- | :--- | :--- |
| **장점** | 시스템 전체가 동일하게 이전됨\<br\>가장 안정적이고 검증된 방법\<br\>작업 시간 비교적 짧음 | 시스템을 깨끗한 상태에서 시작 가능\<br\>디스크 파티션 구조를 새로 설계 가능 |
| **단점** | 복제 후 파티션/스토리지 리사이즈 필수 | 클러스터 환경에서 문제 발생 가능성\<br\>일부 수동 설정이 필요할 수 있음\<br\>Proxmox 버전이 다르면 호환성 문제 발생 |
| **추천 대상** | **모든 사용자 (특히 초보자 및 단일 노드)** | 단일 노드 환경에서 클린 설치를 선호하는 숙련된 사용자 |
