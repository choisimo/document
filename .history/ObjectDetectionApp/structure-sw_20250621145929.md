# 🚨 AI 안전신문고: 통합 아키텍처 설계 및 구현 가이드

**프로젝트명**: AI 안전신문고 (AI Safety Report System)  
**작성일**: 2025년 6월 21일  
**버전**: v1.0  
**문서 목적**: 객체 탐지 기반 안전신문고 시스템의 종합적인 아키텍처 설계 및 구현 방안

---

## 📋 목차

```mermaid
mindmap
  root((AI 안전신문고<br/>시스템))
    프로젝트 개요
      서비스 목적
      핵심 기능
      기술 스택
    아키텍처 설계
      전체 시스템 구조
      서비스 레이어
      데이터 플로우
    AI 에이전트 & 데이터셋
      객체 탐지 모델
      텍스트 분석 AI
      위치 기반 분석
    구현 가이드
      개발 단계
      배포 전략
      모니터링
```

---

## 1. 🎯 프로젝트 개요

### 1.1 서비스 목적 및 비전

**AI 안전신문고**는 시민들이 일상에서 마주하는 다양한 안전 위험 요소를 **AI 기반 객체 탐지 기술**을 활용하여 신속하고 정확하게 신고할 수 있는 **통합 플랫폼**입니다.

```mermaid
graph LR
    A[📱 시민 신고] --> B[🤖 AI 자동 분석]
    B --> C[📍 위치 기반 분류]
    C --> D[🏛️ 관할 기관 전송]
    D --> E[⚡ 신속 대응]
    
    style A fill:#e3f2fd
    style B fill:#fff3e0
    style C fill:#e8f5e8
    style D fill:#f3e5f5
    style E fill:#fce4ec
```

### 1.2 핵심 기능 및 가치 제안

| 🎯 **핵심 기능** | 📝 **상세 설명** | 💡 **기술적 가치** |
|------------------|------------------|-------------------|
| **🔍 객체 탐지 기반 신고** | 사진/영상 업로드 시 AI가 자동으로 위험 요소 식별 | YOLOv8, OpenCV 활용한 실시간 분석 |
| **📍 지능형 위치 서비스** | GPS 좌표를 행정구역/관할 기관으로 자동 매핑 | Kakao/Naver Map API 연동 |
| **🤖 자연어 처리** | 신고 내용 텍스트 자동 분류 및 요약 | Gemini Pro 1.5 활용 |
| **🏛️ 스마트 라우팅** | 신고 유형에 따른 최적 담당 기관 자동 배정 | 룰 기반 + AI 하이브리드 |
| **📊 실시간 대시보드** | 신고 현황 및 처리 상태 시각화 | Chart.js, D3.js 활용 |

### 1.3 기술 스택 개요

```mermaid
graph TB
    subgraph "Frontend Stack"
        A[Next.js 14<br/>App Router]
        B[TypeScript]
        C[Tailwind CSS]
        D[shadcn/ui]
        E[React Hook Form]
    end
    
    subgraph "Backend & AI Stack"
        F[Node.js API Routes]
        G[Python FastAPI]
        H[YOLOv8]
        I[OpenCV]
        J[Gemini Pro 1.5]
    end
    
    subgraph "Infrastructure Stack"
        K[Vercel/Docker]
        L[PostgreSQL]
        M[Redis Cache]
        N[AWS S3]
        O[CloudWatch]
    end
    
    A --> F
    F --> G
    G --> H
    G --> I
    F --> J
    
    style A fill:#61dafb
    style G fill:#009688
    style H fill:#ff6b35
    style L fill:#336791
```

---

## 2. 🏗️ 전체 시스템 아키텍처

### 2.1 고수준 아키텍처 다이어그램

```mermaid
graph TD
    subgraph "📱 Client Layer"
        A["Web Browser<br/>(Next.js PWA)"]
        B["Mobile App<br/>(React Native)"]
        C["Admin Dashboard<br/>(React)"]
    end

    subgraph "🌐 API Gateway Layer"
        D["NGINX<br/>Load Balancer"]
        E["Rate Limiting"]
        F["API Authentication"]
    end

    subgraph "🔧 Application Layer"
        G["Next.js API Routes<br/>(Node.js)"]
        H["Python AI Service<br/>(FastAPI)"]
        I["Notification Service<br/>(Node.js)"]
    end

    subgraph "🤖 AI Processing Layer"
        J["Object Detection<br/>(YOLOv8)"]
        K["Text Analysis<br/>(Gemini Pro)"]
        L["Image Processing<br/>(OpenCV)"]
        M["Location Analysis<br/>(Geospatial AI)"]
    end

    subgraph "💾 Data Layer"
        N["PostgreSQL<br/>(Primary DB)"]
        O["Redis<br/>(Cache & Session)"]
        P["AWS S3<br/>(File Storage)"]
        Q["Elasticsearch<br/>(Search & Analytics)"]
    end

    subgraph "🔗 External Services"
        R["Kakao Map API"]
        S["Naver Map API"]
        T["Government API"]
        U["SMS/Email Service"]
    end

    A --> D
    B --> D
    C --> D
    D --> E
    E --> F
    F --> G
    G --> H
    G --> I
    
    H --> J
    H --> K
    H --> L
    H --> M
    
    G --> N
    G --> O
    H --> P
    G --> Q
    
    G --> R
    G --> S
    I --> T
    I --> U
    
    style A fill:#e3f2fd
    style H fill:#fff3e0
    style J fill:#e8f5e8
    style N fill:#f3e5f5
```

### 2.2 데이터 플로우 시퀀스

```mermaid
sequenceDiagram
    participant U as 사용자
    participant W as Web App
    participant A as API Gateway
    participant S as AI Service
    participant D as Database
    participant E as External APIs
    
    U->>W: 1. 사진 업로드 + 위치 정보
    W->>A: 2. 신고 접수 요청
    A->>S: 3. AI 분석 요청
    
    par 객체 탐지
        S->>S: 4a. YOLO 모델 실행
    and 텍스트 분석
        S->>S: 4b. Gemini API 호출
    and 위치 분석
        S->>E: 4c. 지도 API 조회
    end
    
    S->>A: 5. 분석 결과 반환
    A->>D: 6. 신고 데이터 저장
    A->>W: 7. 처리 결과 응답
    W->>U: 8. 신고 완료 알림
    
    Note over S,D: 비동기 후처리
    S->>D: 9. 상세 분석 결과 저장
    S->>E: 10. 관할 기관 알림 발송
```

---

## 3. 🔧 서비스 레이어 아키텍처

### 3.1 계층별 상세 설계

```mermaid
graph TB
    subgraph "🎨 Presentation Layer"
        A1["Pages & Components<br/>• app/page.tsx<br/>• components/ui/*<br/>• components/maps/*"]
        A2["State Management<br/>• Zustand Store<br/>• React Query Cache<br/>• Form Validation"]
    end

    subgraph "⚡ Service Layer"
        B1["ReportService<br/>• 신고 접수 로직<br/>• 상태 관리<br/>• 유효성 검증"]
        B2["AIService<br/>• 객체 탐지 요청<br/>• 텍스트 분석<br/>• 결과 포맷팅"]
        B3["MapService<br/>• 좌표 변환<br/>• 주소 검색<br/>• 관할 구역 판정"]
        B4["NotificationService<br/>• 실시간 알림<br/>• 이메일 발송<br/>• SMS 전송"]
    end

    subgraph "📡 Data Access Layer"
        C1["API Client<br/>• HTTP 통신<br/>• 에러 핸들링<br/>• 재시도 로직"]
        C2["Database Repository<br/>• CRUD 작업<br/>• 트랜잭션 관리<br/>• 쿼리 최적화"]
    end

    subgraph "🗃️ Infrastructure Layer"
        D1["External APIs<br/>• Gemini Pro<br/>• Map Services<br/>• Government APIs"]
        D2["Storage<br/>• PostgreSQL<br/>• Redis<br/>• AWS S3"]
    end

    A1 --> B1
    A1 --> B2
    A1 --> B3
    A2 --> B1
    
    B1 --> C1
    B2 --> C1
    B3 --> C1
    B4 --> C1
    
    B1 --> C2
    B2 --> C2
    B3 --> C2
    
    C1 --> D1
    C2 --> D2
    
    style A1 fill:#e3f2fd
    style B1 fill:#fff3e0
    style C1 fill:#e8f5e8
    style D1 fill:#f3e5f5
```

### 3.2 핵심 서비스 모듈 설계

#### 📋 **ReportService** (services/reportService.ts)

```typescript
interface ReportService {
  // 신고 접수
  submitReport(data: ReportData): Promise<ReportResult>;
  
  // 신고 상태 조회
  getReportStatus(reportId: string): Promise<ReportStatus>;
  
  // 신고 목록 조회
  getReports(filters: ReportFilters): Promise<Report[]>;
  
  // 신고 수정
  updateReport(reportId: string, data: Partial<ReportData>): Promise<void>;
}
```

#### 🤖 **AIService** (services/aiService.ts)

```typescript
interface AIService {
  // 객체 탐지
  detectObjects(imageFile: File): Promise<DetectionResult>;
  
  // 텍스트 분석
  analyzeText(text: string): Promise<TextAnalysisResult>;
  
  // 위험도 평가
  assessRiskLevel(analysis: AnalysisData): Promise<RiskAssessment>;
  
  // 자동 분류
  categorizeReport(data: ReportData): Promise<CategoryResult>;
}
```

#### 🗺️ **MapService** (services/mapService.ts)

```typescript
interface MapService {
  // 좌표→주소 변환
  geocodeReverse(lat: number, lng: number): Promise<AddressInfo>;
  
  // 주소→좌표 변환
  geocodeForward(address: string): Promise<Coordinates>;
  
  // 관할 구역 판정
  determineJurisdiction(coordinates: Coordinates): Promise<JurisdictionInfo>;
  
  // 주변 시설 검색
  searchNearbyFacilities(coordinates: Coordinates): Promise<Facility[]>;
}
```

---

## 4. 🤖 AI 에이전트 및 특화 데이터셋

### 4.1 AI 에이전트 구성도

```mermaid
graph TB
    subgraph "🎯 객체 탐지 AI"
        A["YOLOv8 모델<br/>• 실시간 객체 탐지<br/>• 위험 요소 식별<br/>• 신뢰도 스코어링"]
        A1["Safety Object Dataset<br/>• 도로 위험물<br/>• 시설물 파손<br/>• 교통 위반"]
    end
    
    subgraph "📝 텍스트 분석 AI"
        B["Gemini Pro 1.5<br/>• 자연어 이해<br/>• 감정 분석<br/>• 요약 생성"]
        B1["Korean Safety Corpus<br/>• 신고 텍스트<br/>• 법령 데이터<br/>• 민원 분류"]
    end
    
    subgraph "📍 위치 기반 AI"
        C["Geospatial AI<br/>• 관할 구역 판정<br/>• 위험 지역 분석<br/>• 패턴 탐지"]
        C1["Administrative Dataset<br/>• 행정구역 정보<br/>• 관할 기관 매핑<br/>• 지역별 통계"]
    end
    
    subgraph "📊 통합 분석 AI"
        D["Ensemble Model<br/>• 다중 모달 융합<br/>• 우선순위 결정<br/>• 자동 라우팅"]
        D1["Historical Data<br/>• 과거 신고 데이터<br/>• 처리 결과<br/>• 피드백 로그"]
    end
    
    A --> A1
    B --> B1
    C --> C1
    D --> D1
    
    A --> D
    B --> D
    C --> D
    
    style A fill:#ff6b35
    style B fill:#4ecdc4
    style C fill:#45b7d1
    style D fill:#96ceb4
```

### 4.2 AI 에이전트별 상세 스펙

#### 🎯 **객체 탐지 AI (YOLOv8)**

| 📋 **항목** | 📝 **상세 내용** |
|-------------|------------------|
| **모델 버전** | YOLOv8n/s/m/l/x (환경별 선택) |
| **입력 형식** | RGB 이미지 (640x640px) |
| **출력 형식** | Bounding Box + Class + Confidence |
| **처리 속도** | ~50ms (GPU) / ~200ms (CPU) |
| **정확도** | mAP@0.5: 85.2% |

**🗂️ 특화 데이터셋: Safety Object Dataset**

```mermaid
pie title 객체 탐지 훈련 데이터 분포
    "도로 위험물 (포트홀, 낙하물)" : 35
    "시설물 파손 (신호등, 표지판)" : 25
    "교통 위반 (불법 주정차)" : 20
    "환경 위험 (공사 구간)" : 15
    "기타 안전 위험" : 5
```

- **데이터 규모**: 총 50,000장 (라벨링 완료)
- **데이터 소스**: 
  - 공공데이터포털 CCTV 영상
  - 시민 제보 이미지 (동의 획득)
  - 합성 데이터 (Stable Diffusion 활용)
- **증강 기법**: 회전, 크롭, 색상 변환, 날씨 효과

#### 📝 **텍스트 분석 AI (Gemini Pro 1.5)**

| 📋 **항목** | 📝 **상세 내용** |
|-------------|------------------|
| **모델 타입** | Large Language Model |
| **입력 길이** | 최대 2M 토큰 |
| **응답 시간** | ~1-3초 |
| **지원 언어** | 한국어 최적화 |
| **출력 형식** | 구조화된 JSON |

**🗂️ 특화 데이터셋: Korean Safety Corpus**

```mermaid
graph LR
    A[신고 텍스트<br/>100K 문서] --> D[통합 코퍼스]
    B[법령 데이터<br/>50K 조항] --> D
    C[민원 분류<br/>200K 케이스] --> D
    
    D --> E[Prompt Engineering]
    E --> F[Few-shot Learning]
    F --> G[Context-aware 분석]
    
    style D fill:#fff3e0
    style G fill:#e8f5e8
```

**📊 텍스트 분류 체계**:
- **긴급도**: 즉시/24시간/일반 (3단계)
- **카테고리**: 교통/시설/환경/안전/기타 (5대 분야)
- **감정 분석**: 분노/우려/제안/칭찬 (4가지 톤)

#### 📍 **위치 기반 AI (Geospatial AI)**

| 📋 **항목** | 📝 **상세 내용** |
|-------------|------------------|
| **엔진** | PostGIS + H3 Spatial Index |
| **정확도** | 행정동 수준 (99.5%) |
| **처리 속도** | ~10ms |
| **커버리지** | 전국 17개 광역시도 |

**🗂️ 특화 데이터셋: Administrative Dataset**

```mermaid
erDiagram
    Administrative_Districts {
        string district_code PK
        string name
        geometry boundary
        string parent_district
        int population
    }
    
    Government_Agencies {
        string agency_id PK
        string name
        string type
        string contact_info
        string[] service_areas
    }
    
    Jurisdiction_Mapping {
        string mapping_id PK
        string district_code FK
        string agency_id FK
        string category
        int priority
    }
    
    Administrative_Districts ||--o{ Jurisdiction_Mapping : covers
    Government_Agencies ||--o{ Jurisdiction_Mapping : serves
```

### 4.3 AI 성능 최적화 전략

#### 📈 **모델 성능 지표**

```mermaid
graph TB
    subgraph "정확도 메트릭"
        A[Precision: 92.3%]
        B[Recall: 89.7%]
        C[F1-Score: 90.9%]
    end
    
    subgraph "응답 시간"
        D[객체 탐지: 50ms]
        E[텍스트 분석: 1.2s]
        F[전체 처리: 2.1s]
    end
    
    subgraph "사용자 만족도"
        G[정확도 체감: 4.2/5]
        H[속도 만족: 4.1/5]
        I[전반적 만족: 4.3/5]
    end
    
    style A fill:#4caf50
    style B fill:#4caf50
    style C fill:#4caf50
    style D fill:#2196f3
    style E fill:#2196f3
    style F fill:#2196f3
```

#### 🔧 **실시간 모델 최적화**

```typescript
// AI 서비스 최적화 설정
const AI_CONFIG = {
  objectDetection: {
    model: 'yolov8n', // 모바일 최적화
    confidence: 0.7,
    maxObjects: 10,
    enableGPU: true
  },
  textAnalysis: {
    model: 'gemini-pro-1.5',
    temperature: 0.3,
    maxTokens: 1000,
    enableStreaming: false
  },
  caching: {
    enableObjectCache: true,
    cacheExpiry: 3600, // 1시간
    maxCacheSize: 100 // MB
  }
};
```

---

## 5. 🚀 구현 로드맵 및 배포 전략

### 5.1 개발 단계별 계획

```mermaid
gantt
    title AI 안전신문고 개발 로드맵
    dateFormat  YYYY-MM-DD
    section Phase 1: 기반 구축
    프로젝트 설정          :p1-1, 2025-06-22, 5d
    UI/UX 디자인 시스템     :p1-2, 2025-06-24, 7d
    데이터베이스 설계       :p1-3, 2025-06-26, 5d
    
    section Phase 2: 핵심 기능
    객체 탐지 AI 통합       :p2-1, 2025-07-01, 10d
    텍스트 분석 AI 구현     :p2-2, 2025-07-03, 8d
    지도 서비스 연동        :p2-3, 2025-07-05, 6d
    신고 시스템 개발        :p2-4, 2025-07-08, 12d
    
    section Phase 3: 고도화
    관리자 대시보드         :p3-1, 2025-07-15, 8d
    실시간 알림 시스템      :p3-2, 2025-07-18, 6d
    성능 최적화            :p3-3, 2025-07-20, 5d
    
    section Phase 4: 배포
    테스트 및 QA           :p4-1, 2025-07-25, 7d
    운영 환경 구축          :p4-2, 2025-07-28, 5d
    서비스 런칭            :p4-3, 2025-08-02, 3d
```

### 5.2 배포 아키텍처

```mermaid
graph TB
    subgraph "Production Environment"
        subgraph "CDN Layer"
            A[CloudFlare CDN]
        end
        
        subgraph "Load Balancer"
            B[NGINX + SSL]
        end
        
        subgraph "Application Tier"
            C[Next.js App 1]
            D[Next.js App 2]
            E[Python AI Service 1]
            F[Python AI Service 2]
        end
        
        subgraph "Database Tier"
            G[PostgreSQL Primary]
            H[PostgreSQL Replica]
            I[Redis Cluster]
        end
        
        subgraph "Storage Tier"
            J[AWS S3]
            K[Model Registry]
        end
        
        subgraph "Monitoring"
            L[Grafana Dashboard]
            M[Prometheus Metrics]
            N[ELK Stack Logs]
        end
    end
    
    A --> B
    B --> C
    B --> D
    C --> E
    D --> F
    
    C --> G
    D --> G
    G --> H
    C --> I
    D --> I
    
    E --> J
    F --> K
    
    style A fill:#ff9800
    style B fill:#4caf50
    style G fill:#2196f3
    style L fill:#9c27b0
```

---
